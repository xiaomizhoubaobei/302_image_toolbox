# 图像纹理分析功能开发文档

## 1. 功能概述

### 1.1 功能名称
图像纹理分析 (Image Texture Analysis)

### 1.2 功能描述
图像纹理分析功能利用计算机视觉和机器学习技术，对图片中的纹理特征进行深度分析，包括纹理类型识别、粗糙度评估、方向性分析等。该功能可广泛应用于材料科学、地质勘探、医学诊断等领域。

### 1.3 目标用户
- 材料科学研究人员
- 地质勘探工程师
- 医学影像分析师
- 质量检测工程师
- 需要纹理分析的科研人员

## 2. 功能需求

### 2.1 核心功能
1. **纹理类型识别**：识别图片中的纹理类型（光滑、粗糙、规则、不规则等）
2. **粗糙度评估**：量化纹理的粗糙程度
3. **方向性分析**：分析纹理的方向性特征
4. **周期性检测**：检测纹理的周期性模式
5. **纹理对比度分析**：分析纹理区域与背景的对比度
6. **统计特征提取**：提取纹理的统计特征参数

### 2.2 用户界面需求
1. 图片上传区域
2. 纹理分析结果显示
3. 纹理特征可视化
4. 统计图表展示
5. 分析报告生成
6. 历史记录查看

## 3. 技术实现方案

### 3.1 技术架构
```
前端组件层:
- TextureAnalyzer.tsx (主组件)
- TextureVisualization.tsx (纹理可视化组件)
- FeatureDisplay.tsx (特征显示组件)
- StatisticalCharts.tsx (统计图表组件)
- AnalysisReport.tsx (分析报告组件)

状态管理层:
- Zustand store (扩展现有状态)
- textureSlice.ts (纹理分析功能状态)

API层:
- lib/api.ts (新增纹理分析API调用)
- utils/TextureAnalysis.ts (纹理分析工具)

类型定义层:
- types/index.ts (新增类型定义)
```

### 3.2 API接口设计
```typescript
// 图像纹理分析API接口
interface TextureAnalysisAction {
  imageSrc: string;
  analysisMode: 'basic' | 'standard' | 'detailed' | 'research';
  textureFeatures: {
    glcm: boolean; // 灰度共生矩阵
    lbp: boolean; // 局部二值模式
    gabor: boolean; // Gabor滤波器
    fractal: boolean; // 分形维数
  };
  roiSelection?: {
    x: number;
    y: number;
    width: number;
    height: number;
  };
  outputFormat?: 'json' | 'pdf' | 'csv';
}

interface TextureFeatures {
  homogeneity: number; // 同质性 0-100
  contrast: number; // 对比度 0-100
  energy: number; // 能量 0-100
  correlation: number; // 相关性 0-100
  asm: number; // 角二阶矩 0-100
  dissimilarity: number; // 相异性 0-100
}

interface TextureClassification {
  type: 'smooth' | 'rough' | 'regular' | 'irregular' | 'directional' | 'non_directional';
  confidence: number; // 置信度 0-100
  description: string;
}

interface TextureAnalysisResult {
  textureFeatures: TextureFeatures;
  textureClassification: TextureClassification;
  roughness: number; // 粗糙度 0-100
  directionality: {
    hasDirection: boolean;
    dominantAngle?: number; // 主导角度 0-360
    strength: number; // 方向强度 0-100
  };
  periodicity: {
    isPeriodic: boolean;
    period?: number; // 周期长度
    regularity: number; // 规则性 0-100
  };
  statisticalData: {
    mean: number;
    variance: number;
    skewness: number;
    kurtosis: number;
  };
  processingTime: number; // 处理时间(ms)
  analysisQuality: number; // 分析质量 0-100
}

// 主要API函数
export async function analyzeTexture(action: TextureAnalysisAction): Promise<TextureAnalysisResult> {
  // 实现图像纹理分析逻辑
}
```

### 3.3 组件设计

#### 3.3.1 主组件 TextureAnalyzer.tsx
```tsx
import React from 'react';
import { TextureVisualization } from './TextureVisualization';
import { FeatureDisplay } from './FeatureDisplay';
import { StatisticalCharts } from './StatisticalCharts';
import { AnalysisReport } from './AnalysisReport';
import { useTextureStore } from '@/stores/textureSlice';

export function TextureAnalyzer() {
  const { 
    originalImage, 
    analysisResult, 
    textureParams,
    setTextureParams,
    analyzeTexture,
    isProcessing
  } = useTextureStore();

  return (
    <div className="texture-analyzer-container">
      <div className="analyzer-header">
        <h2>图像纹理分析</h2>
        <p>深度分析图片纹理特征，识别类型并提取统计参数</p>
      </div>
      
      <div className="analyzer-content">
        <div className="analyzer-sidebar">
          <div className="analysis-controls">
            <h3>分析设置</h3>
            <div className="control-group">
              <label>分析深度</label>
              <select
                value={textureParams.analysisMode}
                onChange={(e) => setTextureParams({ 
                  ...textureParams, 
                  analysisMode: e.target.value as any 
                })}
                disabled={isProcessing}
              >
                <option value="basic">基础分析</option>
                <option value="standard">标准分析</option>
                <option value="detailed">详细分析</option>
                <option value="research">研究分析</option>
              </select>
            </div>
            
            <div className="feature-selection">
              <h4>纹理特征</h4>
              <label className="checkbox-label">
                <input
                  type="checkbox"
                  checked={textureParams.textureFeatures.glcm}
                  onChange={(e) => setTextureParams({ 
                    ...textureParams, 
                    textureFeatures: { 
                      ...textureParams.textureFeatures, 
                      glcm: e.target.checked 
                    } 
                  })}
                  disabled={isProcessing}
                />
                灰度共生矩阵
              </label>
              <label className="checkbox-label">
                <input
                  type="checkbox"
                  checked={textureParams.textureFeatures.lbp}
                  onChange={(e) => setTextureParams({ 
                    ...textureParams, 
                    textureFeatures: { 
                      ...textureParams.textureFeatures, 
                      lbp: e.target.checked 
                    } 
                  })}
                  disabled={isProcessing}
                />
                局部二值模式
              </label>
              <label className="checkbox-label">
                <input
                  type="checkbox"
                  checked={textureParams.textureFeatures.gabor}
                  onChange={(e) => setTextureParams({ 
                    ...textureParams, 
                    textureFeatures: { 
                      ...textureParams.textureFeatures, 
                      gabor: e.target.checked 
                    } 
                  })}
                  disabled={isProcessing}
                />
                Gabor滤波器
              </label>
              <label className="checkbox-label">
                <input
                  type="checkbox"
                  checked={textureParams.textureFeatures.fractal}
                  onChange={(e) => setTextureParams({ 
                    ...textureParams, 
                    textureFeatures: { 
                      ...textureParams.textureFeatures, 
                      fractal: e.target.checked 
                    } 
                  })}
                  disabled={isProcessing}
                />
                分形维数
              </label>
            </div>
          </div>
        </div>
        
        <div className="analyzer-main">
          <div className="image-preview">
            {originalImage && (
              <img src={originalImage} alt="待分析图片" />
            )}
          </div>
          
          {analysisResult && !isProcessing && (
            <div className="analysis-results">
              <TextureVisualization 
                image={originalImage}
                features={analysisResult.textureFeatures}
              />
              
              <FeatureDisplay 
                classification={analysisResult.textureClassification}
                roughness={analysisResult.roughness}
                directionality={analysisResult.directionality}
                periodicity={analysisResult.periodicity}
              />
              
              <StatisticalCharts 
                statisticalData={analysisResult.statisticalData}
                features={analysisResult.textureFeatures}
              />
              
              <AnalysisReport 
                result={analysisResult}
                onExport={() => {
                  // 导出报告逻辑
                }}
              />
            </div>
          )}
          
          {isProcessing && (
            <div className="processing-indicator">
              <div className="spinner"></div>
              <p>正在分析纹理特征...</p>
            </div>
          )}
        </div>
      </div>
      
      <div className="analyzer-footer">
        <button 
          className="analyze-button"
          disabled={!originalImage || isProcessing}
          onClick={analyzeTexture}
        >
          {isProcessing ? '分析中...' : '开始分析'}
        </button>
        
        {analysisResult && (
          <div className="action-buttons">
            <button className="export-button" onClick={() => {
              // 导出分析结果逻辑
            }}>
              导出结果
            </button>
            
            <button className="report-button" onClick={() => {
              // 生成报告逻辑
            }}>
              生成报告
            </button>
          </div>
        )}
      </div>
    </div>
  );
}
```

#### 3.3.2 特征显示组件 FeatureDisplay.tsx
```tsx
import React from 'react';
import { TextureClassification } from '@/types';

interface FeatureDisplayProps {
  classification: TextureClassification;
  roughness: number;
  directionality: any;
  periodicity: any;
}

export function FeatureDisplay({ 
  classification, 
  roughness, 
  directionality, 
  periodicity 
}: FeatureDisplayProps) {
  return (
    <div className="feature-display">
      <h3>纹理特征</h3>
      
      <div className="classification">
        <h4>纹理类型</h4>
        <div className="classification-result">
          <span className="type">{classification.type}</span>
          <span className="confidence">置信度: {classification.confidence}%</span>
          <p className="description">{classification.description}</p>
        </div>
      </div>
      
      <div className="measurements">
        <div className="measurement-item">
          <label>粗糙度</label>
          <div className="measurement-bar">
            <div 
              className="measurement-fill"
              style={{ width: `${roughness}%` }}
            ></div>
            <span className="measurement-value">{roughness}%</span>
          </div>
        </div>
        
        <div className="measurement-item">
          <label>方向性</label>
          <div className="directionality-info">
            <span>{directionality.hasDirection ? '有方向性' : '无方向性'}</span>
            {directionality.hasDirection && (
              <span>主导角度: {directionality.dominantAngle}°</span>
            )}
            <span>强度: {directionality.strength}%</span>
          </div>
