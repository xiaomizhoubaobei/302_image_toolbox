# 图像质量评估功能开发文档

## 1. 功能概述

### 1.1 功能名称
图像质量评估 (Image Quality Assessment)

### 1.2 功能描述
图像质量评估功能利用AI技术对图片的视觉质量进行客观和主观评估，包括清晰度、噪声水平、色彩准确性、构图合理性等多个维度。该功能可帮助用户了解图片质量状况，并提供改善建议。

### 1.3 目标用户
- 专业摄影师
- 图像处理专家
- 内容审核人员
- 电商图片质量管控人员
- 需要评估图片质量的普通用户

## 2. 功能需求

### 2.1 核心功能
1. **综合质量评分**：提供0-100分的综合质量评分
2. **清晰度分析**：评估图片的锐度和细节表现
3. **噪声检测**：识别并量化图片中的噪声水平
4. **色彩分析**：评估色彩准确性和饱和度
5. **曝光评估**：分析图片的曝光是否合理
6. **构图评价**：评估图片构图的合理性
7. **改善建议**：根据评估结果提供具体改善建议

### 2.2 用户界面需求
1. 图片上传区域
2. 质量评分显示
3. 各项指标详细分析
4. 雷达图表可视化
5. 改善建议面板
6. 历史记录查看

## 3. 技术实现方案

### 3.1 技术架构
```
前端组件层:
- QualityAssessor.tsx (主组件)
- ScoreDisplay.tsx (评分显示组件)
- MetricsAnalysis.tsx (指标分析组件)
- RadarChart.tsx (雷达图表组件)
- ImprovementSuggestions.tsx (改善建议组件)
- HistoryViewer.tsx (历史记录查看器)

状态管理层:
- Zustand store (扩展现有状态)
- qualitySlice.ts (质量评估功能状态)

API层:
- lib/api.ts (新增质量评估API调用)
- utils/ImageQuality.ts (图像质量工具)

类型定义层:
- types/index.ts (新增类型定义)
```

### 3.2 API接口设计
```typescript
// 图像质量评估API接口
interface ImageQualityAssessmentAction {
  imageSrc: string;
  assessmentType: 'basic' | 'standard' | 'detailed';
  includeSuggestions: boolean;
  outputFormat?: 'json' | 'pdf' | 'csv';
}

interface QualityMetrics {
  sharpness: number; // 清晰度 0-100
  noise: number; // 噪声水平 0-100 (越低越好)
  colorAccuracy: number; // 色彩准确性 0-100
  exposure: number; // 曝光合理性 0-100
  composition: number; // 构图合理性 0-100
  brightness: number; // 亮度 0-100
  contrast: number; // 对比度 0-100
  saturation: number; // 饱和度 0-100
}

interface ImprovementSuggestion {
  category: 'sharpness' | 'noise' | 'color' | 'exposure' | 'composition';
  priority: 'high' | 'medium' | 'low';
  description: string;
  recommendation: string;
}

interface ImageQualityAssessmentResult {
  overallScore: number; // 综合评分 0-100
  metrics: QualityMetrics;
  suggestions?: ImprovementSuggestion[];
  assessmentDetails: {
    assessmentTime: number; // 评估时间(ms)
    imageInfo: {
      width: number;
      height: number;
      fileSize: number;
      format: string;
    };
    technicalInfo: {
      assessmentMethod: string;
      confidence: number; // 评估置信度 0-100
    };
  };
}

// 主要API函数
export async function assessImageQuality(action: ImageQualityAssessmentAction): Promise<ImageQualityAssessmentResult> {
  // 实现图像质量评估逻辑
}
```

### 3.3 组件设计

#### 3.3.1 主组件 QualityAssessor.tsx
```tsx
import React from 'react';
import { ScoreDisplay } from './ScoreDisplay';
import { MetricsAnalysis } from './MetricsAnalysis';
import { RadarChart } from './RadarChart';
import { ImprovementSuggestions } from './ImprovementSuggestions';
import { HistoryViewer } from './HistoryViewer';
import { useQualityStore } from '@/stores/qualitySlice';

export function QualityAssessor() {
  const { 
    originalImage, 
    assessmentResult, 
    qualityParams,
    setQualityParams,
    assessImageQuality,
    isProcessing
  } = useQualityStore();

  return (
    <div className="quality-assessor-container">
      <div className="assessor-header">
        <h2>图像质量评估</h2>
        <p>全面评估图片质量，提供专业改善建议</p>
      </div>
      
      <div className="assessor-content">
        <div className="assessor-sidebar">
          <div className="assessment-controls">
            <h3>评估设置</h3>
            <div className="control-group">
              <label>评估深度</label>
              <select
                value={qualityParams.assessmentType}
                onChange={(e) => setQualityParams({ 
                  ...qualityParams, 
                  assessmentType: e.target.value as any 
                })}
                disabled={isProcessing}
              >
                <option value="basic">基础评估</option>
                <option value="standard">标准评估</option>
                <option value="detailed">详细评估</option>
              </select>
            </div>
            
            <label className="checkbox-label">
              <input
                type="checkbox"
                checked={qualityParams.includeSuggestions}
                onChange={(e) => setQualityParams({ 
                  ...qualityParams, 
                  includeSuggestions: e.target.checked 
                })}
                disabled={isProcessing}
              />
              包含改善建议
            </label>
          </div>
          
          {assessmentResult && (
            <HistoryViewer 
              onHistorySelect={(historyItem) => {
                // 处理历史记录选择
              }}
            />
          )}
        </div>
        
        <div className="assessor-main">
          <div className="image-preview">
            {originalImage && (
              <img src={originalImage} alt="待评估图片" />
            )}
          </div>
          
          {assessmentResult && !isProcessing && (
            <div className="assessment-results">
              <ScoreDisplay 
                score={assessmentResult.overallScore}
                metrics={assessmentResult.metrics}
              />
              
              <div className="detailed-analysis">
                <RadarChart 
                  metrics={assessmentResult.metrics}
                />
                
                <MetricsAnalysis 
                  metrics={assessmentResult.metrics}
                />
              </div>
              
              {qualityParams.includeSuggestions && assessmentResult.suggestions && (
                <ImprovementSuggestions 
                  suggestions={assessmentResult.suggestions}
                />
              )}
            </div>
          )}
          
          {isProcessing && (
            <div className="processing-indicator">
              <div className="spinner"></div>
              <p>正在评估图片质量...</p>
            </div>
          )}
        </div>
      </div>
      
      <div className="assessor-footer">
        <button 
          className="assess-button"
          disabled={!originalImage || isProcessing}
          onClick={assessImageQuality}
        >
          {isProcessing ? '评估中...' : '开始评估'}
        </button>
        
        {assessmentResult && (
          <div className="action-buttons">
            <button className="export-button" onClick={() => {
              // 导出评估报告逻辑
            }}>
              导出报告
            </button>
            
            <button className="save-button" onClick={() => {
              // 保存评估结果逻辑
            }}>
              保存结果
            </button>
          </div>
        )}
      </div>
    </div>
  );
}
```

#### 3.3.2 评分显示组件 ScoreDisplay.tsx
```tsx
import React from 'react';
import { QualityMetrics } from '@/types';

interface ScoreDisplayProps {
  score: number;
  metrics: QualityMetrics;
}

export function ScoreDisplay({ score, metrics }: ScoreDisplayProps) {
  // 根据评分确定等级
  const getScoreLevel = (score: number) => {
    if (score >= 80) return { level: '优秀', color: 'green' };
    if (score >= 60) return { level: '良好', color: 'blue' };
    if (score >= 40) return { level: '一般', color: 'orange' };
    return { level: '较差', color: 'red' };
  };

  const scoreLevel = getScoreLevel(score);

  return (
    <div className="score-display">
      <div className="overall-score">
        <div className="score-circle" style={{ borderColor: scoreLevel.color }}>
          <span className="score-number">{score}</span>
          <span className="score-level" style={{ color: scoreLevel.color }}>
            {scoreLevel.level}
          </span>
        </div>
      </div>
      
      <div className="metrics-summary">
        <div className="metric-item">
          <span>清晰度</span>
          <span>{metrics.sharpness}</span>
        </div>
        <div className="metric-item">
          <span>噪声</span>
          <span>{metrics.noise}</span>
        </div>
        <div className="metric-item">
          <span>色彩</span>
          <span>{metrics.colorAccuracy}</span>
        </div>
        <div className="metric-item">
          <span>曝光</span>
          <span>{metrics.exposure}</span>
        </div>
      </div>
    </div>
  );
}
```

## 4. 状态管理设计

### 4.1 Zustand Store 扩展
```typescript
// stores/qualitySlice.ts
import { create } from 'zustand';
import { devtools } from 'zustand/middleware';

interface QualityParams {
  assessmentType: 'basic' | 'standard' | 'detailed';
  includeSuggestions: boolean;
  outputFormat?: 'json' | 'pdf' | 'csv';
}

interface QualityState {
  originalImage: string | null;
  assessmentResult: any | null;
  qualityParams: QualityParams;
  isProcessing: boolean;
  setOriginalImage: (image: string) => void;
  setQualityParams: (params: QualityParams) => void;
  assessImageQuality: () => Promise<void>;
}

export const useQualityStore = create<QualityState>()(
  devtools((set, get) => ({
    originalImage: null,
    assessmentResult: null,
    qualityParams: {
      assessmentType: 'standard',
      includeSuggestions: true,
      outputFormat: 'json'
    },
    isProcessing: false,
    
    setOriginalImage: (image) => set({ originalImage: image }),
    
    setQualityParams: (params) => set({ qualityParams: params }),
    
    assessImageQuality: async () => {
      const { originalImage, qualityParams } = get();
      if (!originalImage) return;
      
      set({ isProcessing: true });
      
      try {
        const result = await assessImageQuality({
          imageSrc: originalImage,
          ...qualityParams
        });
        
        set({ 
          assessmentResult: result,
          isProcessing: false 
        });
      } catch (error) {
        set({ isProcessing: false });
        throw error;
      }
    }
  }))
);
```

## 5. UI/UX 设计

### 5.1 界面布局
```
+---------------------------------------------------------------+
| 图像质量评估工具                                              |
+-----------+---------------------------------------------------+
| 设置面板  | 结果显示区域                                          |
|           |                                                   |
| [评估深度] | [图片预览区域]                                    |
| 基础      |                                                   |
| 标准      | [综合评分: 85分 优秀]                             |
| 详细      |    ○○○○○○○○○○                                       |
|           |                                                   |
| [√]建议   | [雷达图表]                                       |
|           | ████████████                                      |
| [历史记录] | ████                                              |
|           |                                                   |
|           | [详细指标分析]                                   |
|           | 清晰度: 90   噪声: 20   色彩: 85   曝光: 75        |
|           |                                                   |
|           | [改善建议]                                       |
|           | - 提高对比度以增强细节表现                        |
|           | - 调整白平衡以改善色彩准确性                      |
|           | - 稍微增加锐度以提升清晰度                        |
+-----------+---------------------------------------------------+
| [上传图片] [开始评估] [导出报告] [保存结果]                   |
+---------------------------------------------------------------+
```

### 5.2 交互流程
1. 用户上传需要评估的图片
2. 设置评估参数（深度、是否包含建议等）
3. 点击"开始评估"按钮
4. 显示处理进度
5. 展示综合评分和各项指标
6. 显示雷达图表和详细分析
7. 提供改善建议
8. 支持导出报告和保存结果
9. 可查看历史评估记录

## 6. 开发计划

### 6.1 第一阶段：基础框架搭建 (1周)
- [ ] 创建组件结构和文件
- [ ] 实现 Zustand 状态管理
- [ ] 设计 UI 组件
- [ ] 实现图片上传功能

### 6.2 第二阶段：核心功能开发 (2周)
- [ ] 实现综合质量评分功能
- [ ] 实现清晰度分析功能
- [ ] 实现噪声检测功能
- [ ] 实现色彩分析功能

### 6.3 第三阶段：增强功能开发 (1周)
- [ ] 实现曝光评估功能
- [ ] 实现构图评价功能
- [ ] 添加改善建议功能
- [ ] 实现历史记录功能

### 6.4 第四阶段：测试与优化 (1周)
- [ ] 功能测试
- [ ] 性能优化
- [ ] 用户体验优化
- [ ] 文档完善

## 7. 测试方案

### 7.1 单元测试
- 测试状态管理功能
- 测试评分算法逻辑
- 测试参数验证逻辑

### 7.2 集成测试
- 测试完整的质量评估流程
- 测试不同图片类型的评估效果
- 测试改善建议的准确性

### 7.3 用户验收测试
- 邀请摄影师测试评估效果
- 收集用户反馈
- 优化用户体验

## 8. 部署与维护

### 8.1 部署要求
- 确保302.AI API密钥配置正确
- 验证图像上传和处理功能
- 测试不同浏览器兼容性

### 8.2 维护计划
- 监控API调用情况
- 收集用户反馈并持续优化
- 定期更新评估算法
- 扩展支持的评估维度