# åŠ¨æ€ç‰¹æ•ˆç”ŸæˆåŠŸèƒ½å¼€å‘æ–‡æ¡£

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 åŠŸèƒ½åç§°
åŠ¨æ€ç‰¹æ•ˆç”Ÿæˆ (Dynamic Effects Generator)

### 1.2 åŠŸèƒ½æè¿°
åŠ¨æ€ç‰¹æ•ˆç”ŸæˆåŠŸèƒ½ä¸ºé™æ€å›¾ç‰‡æ·»åŠ å„ç§åŠ¨æ€è§†è§‰æ•ˆæœï¼ŒåŒ…æ‹¬ç²’å­æ•ˆæœã€å…‰æ•ˆã€æµåŠ¨æ•ˆæœã€éœ“è™¹æ•ˆæœç­‰ã€‚é€šè¿‡AIæŠ€æœ¯å’ŒåŠ¨ç”»ç®—æ³•ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿè½»æ¾åˆ›å»ºå…·æœ‰è§†è§‰å†²å‡»åŠ›çš„åŠ¨æ€å›¾ç‰‡ã€‚

### 1.3 ç›®æ ‡ç”¨æˆ·
- ç¤¾äº¤åª’ä½“å†…å®¹åˆ›ä½œè€…
- è§†é¢‘åˆ¶ä½œäººå‘˜
- å¹³é¢è®¾è®¡å¸ˆ
- æ•°å­—è‰ºæœ¯å®¶

## 2. åŠŸèƒ½éœ€æ±‚

### 2.1 æ ¸å¿ƒåŠŸèƒ½
1. **å¤šç§åŠ¨æ€æ•ˆæœ**ï¼šæä¾›è‡³å°‘15ç§ä¸åŒçš„åŠ¨æ€ç‰¹æ•ˆ
2. **å‚æ•°è°ƒèŠ‚**ï¼šæ”¯æŒæ•ˆæœå¼ºåº¦ã€é€Ÿåº¦ã€é¢œè‰²ç­‰å‚æ•°è°ƒèŠ‚
3. **å®æ—¶é¢„è§ˆ**ï¼šæä¾›åŠ¨æ€æ•ˆæœçš„å®æ—¶é¢„è§ˆ
4. **è‡ªå®šä¹‰åŠ¨ç”»**ï¼šæ”¯æŒç”¨æˆ·åˆ›å»ºè‡ªå®šä¹‰åŠ¨ç”»è·¯å¾„
5. **å¯¼å‡ºæ ¼å¼**ï¼šæ”¯æŒGIFã€MP4ã€WebMç­‰æ ¼å¼å¯¼å‡º

### 2.2 ç”¨æˆ·ç•Œé¢éœ€æ±‚
1. ç‰¹æ•ˆé€‰æ‹©é¢æ¿
2. å‚æ•°è°ƒèŠ‚æ§åˆ¶é¢æ¿
3. å®æ—¶é¢„è§ˆçª—å£
4. åŠ¨ç”»æ—¶é—´è½´
5. å¯¼å‡ºè®¾ç½®é¢æ¿

## 3. æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 3.1 æŠ€æœ¯æ¶æ„
```
å‰ç«¯ç»„ä»¶å±‚:
- DynamicEffects.tsx (ä¸»ç»„ä»¶)
- EffectSelector.tsx (ç‰¹æ•ˆé€‰æ‹©å™¨)
- EffectPreview.tsx (é¢„è§ˆç»„ä»¶)
- EffectControls.tsx (æ§åˆ¶é¢æ¿)
- AnimationTimeline.tsx (åŠ¨ç”»æ—¶é—´è½´)

çŠ¶æ€ç®¡ç†å±‚:
- Zustand store (æ‰©å±•ç°æœ‰çŠ¶æ€)
- effectsSlice.ts (ç‰¹æ•ˆåŠŸèƒ½çŠ¶æ€)

APIå±‚:
- lib/api.ts (æ–°å¢ç‰¹æ•ˆAPIè°ƒç”¨)
- utils/DynamicEffects.ts (ç‰¹æ•ˆå¤„ç†å·¥å…·)

ç±»å‹å®šä¹‰å±‚:
- types/index.ts (æ–°å¢ç±»å‹å®šä¹‰)
```

### 3.2 APIæ¥å£è®¾è®¡
```typescript
// åŠ¨æ€ç‰¹æ•ˆAPIæ¥å£
interface DynamicEffectsAction {
  imageSrc: string;
  effectType: DynamicEffectType;
  parameters: EffectParameters;
  animationSettings: {
    duration: number; // åŠ¨ç”»æ—¶é•¿(ç§’)
    fps: number; // å¸§ç‡
    loop: boolean; // æ˜¯å¦å¾ªç¯
  };
  outputFormat: 'gif' | 'mp4' | 'webm';
}

interface EffectParameters {
  intensity: number; // å¼ºåº¦ 0-100
  speed: number; // é€Ÿåº¦ 0-100
  color?: string; // é¢œè‰²
  size?: number; // å¤§å° 0-100
  direction?: 'left' | 'right' | 'up' | 'down' | 'random'; // æ–¹å‘
  density?: number; // å¯†åº¦ 0-100
}

type DynamicEffectType = 
  | 'particle_rain'      // ç²’å­é›¨
  | 'particle_fire'      // ç«ç„°ç²’å­
  | 'particle_snow'      // é›ªèŠ±ç²’å­
  | 'light_beam'         // å…‰æŸæ•ˆæœ
  | 'lightning'          // é—ªç”µæ•ˆæœ
  | 'glow'               // å‘å…‰æ•ˆæœ
  | 'neon'               // éœ“è™¹æ•ˆæœ
  | 'water_ripple'       // æ°´æ³¢çº¹
  | 'fireworks'          // çƒŸèŠ±æ•ˆæœ
  | 'confetti'           // å½©çº¸æ•ˆæœ
  | 'bubbles'            // æ°”æ³¡æ•ˆæœ
  | 'sparkles'           // é—ªçƒæ•ˆæœ
  | 'swirl'              // æ¼©æ¶¡æ•ˆæœ
  | 'wave'               // æ³¢æµªæ•ˆæœ
  | 'pulse'              // è„‰å†²æ•ˆæœ
  | 'custom_path';       // è‡ªå®šä¹‰è·¯å¾„

interface DynamicEffectsResult {
  videoSrc: string;
  processingTime: number; // å¤„ç†æ—¶é—´(ms)
  frameCount: number; // å¸§æ•°
}

// ä¸»è¦APIå‡½æ•°
export async function generateDynamicEffects(action: DynamicEffectsAction): Promise<DynamicEffectsResult> {
  // å®ç°åŠ¨æ€ç‰¹æ•ˆç”Ÿæˆé€»è¾‘
}
```

### 3.3 ç»„ä»¶è®¾è®¡

#### 3.3.1 ä¸»ç»„ä»¶ DynamicEffects.tsx
```tsx
import React from 'react';
import { EffectSelector } from './EffectSelector';
import { EffectPreview } from './EffectPreview';
import { EffectControls } from './EffectControls';
import { AnimationTimeline } from './AnimationTimeline';
import { useEffectsStore } from '@/stores/effectsSlice';

export function DynamicEffects() {
  const { 
    originalImage, 
    effectResult, 
    effectParams,
    animationSettings,
    setEffectParams,
    setAnimationSettings,
    generateDynamicEffects,
    isProcessing
  } = useEffectsStore();

  return (
    <div className="dynamic-effects-container">
      <div className="effects-header">
        <h2>åŠ¨æ€ç‰¹æ•ˆç”Ÿæˆ</h2>
        <p>ä¸ºæ‚¨çš„å›¾ç‰‡æ·»åŠ ç‚«é…·çš„åŠ¨æ€è§†è§‰æ•ˆæœ</p>
      </div>
      
      <div className="effects-content">
        <div className="effects-sidebar">
          <EffectSelector 
            selectedEffect={effectParams.effectType}
            onSelectEffect={(effect) => setEffectParams({ ...effectParams, effectType: effect })}
          />
          
          <EffectControls 
            params={effectParams}
            animationSettings={animationSettings}
            onChange={setEffectParams}
            onAnimationChange={setAnimationSettings}
            onGenerate={generateDynamicEffects}
            isProcessing={isProcessing}
          />
        </div>
        
        <div className="effects-main">
          <EffectPreview 
            image={originalImage}
            result={effectResult}
            isProcessing={isProcessing}
            isPlaying={true}
          />
        </div>
        
        <div className="effects-timeline">
          <AnimationTimeline 
            settings={animationSettings}
            onChange={setAnimationSettings}
          />
        </div>
      </div>
    </div>
  );
}
```

#### 3.3.2 ç‰¹æ•ˆé€‰æ‹©å™¨ EffectSelector.tsx
```tsx
import React from 'react';
import { DynamicEffectType } from '@/types';

interface EffectOption {
  id: DynamicEffectType;
  name: string;
  description: string;
  icon: string;
  previewImage: string;
}

const EFFECT_OPTIONS: EffectOption[] = [
  {
    id: 'particle_rain',
    name: 'ç²’å­é›¨',
    description: 'é£˜è½çš„å½©è‰²ç²’å­æ•ˆæœ',
    icon: 'ğŸŒ§ï¸',
    previewImage: '/images/effects/particle_rain.gif'
  },
  {
    id: 'particle_fire',
    name: 'ç«ç„°ç²’å­',
    description: 'ç‡ƒçƒ§çš„ç«ç„°ç²’å­æ•ˆæœ',
    icon: 'ğŸ”¥',
    previewImage: '/images/effects/particle_fire.gif'
  },
  {
    id: 'light_beam',
    name: 'å…‰æŸæ•ˆæœ',
    description: 'ç‚«ç›®çš„å…‰çº¿æŸæ•ˆæœ',
    icon: 'âœ¨',
    previewImage: '/images/effects/light_beam.gif'
  },
  {
    id: 'neon',
    name: 'éœ“è™¹æ•ˆæœ',
    description: 'é—ªçƒçš„éœ“è™¹ç¯å…‰æ•ˆæœ',
    icon: 'ğŸ’¡',
    previewImage: '/images/effects/neon.gif'
  },
  {
    id: 'water_ripple',
    name: 'æ°´æ³¢çº¹',
    description: 'æ°´é¢æ³¢çº¹æ‰©æ•£æ•ˆæœ',
    icon: 'ğŸ’§',
    previewImage: '/images/effects/water_ripple.gif'
  }
  // æ›´å¤šç‰¹æ•ˆé€‰é¡¹...
];

interface EffectSelectorProps {
  selectedEffect: DynamicEffectType;
  onSelectEffect: (effect: DynamicEffectType) => void;
}

export function EffectSelector({ selectedEffect, onSelectEffect }: EffectSelectorProps) {
  return (
    <div className="effect-selector">
      <h3>é€‰æ‹©åŠ¨æ€ç‰¹æ•ˆ</h3>
      <div className="effect-grid">
        {EFFECT_OPTIONS.map((effect) => (
          <div 
            key={effect.id}
            className={`effect-option ${selectedEffect === effect.id ? 'selected' : ''}`}
            onClick={() => onSelectEffect(effect.id)}
          >
            <div className="effect-icon">{effect.icon}</div>
            <div className="effect-info">
              <h4>{effect.name}</h4>
              <p>{effect.description}</p>
            </div>
            <div className="effect-preview">
              <img src={effect.previewImage} alt={effect.name} />
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}
```

## 4. çŠ¶æ€ç®¡ç†è®¾è®¡

### 4.1 Zustand Store æ‰©å±•
```typescript
// stores/effectsSlice.ts
import { create } from 'zustand';
import { devtools } from 'zustand/middleware';
import { DynamicEffectType } from '@/types';

interface EffectParameters {
  effectType: DynamicEffectType;
  intensity: number;
  speed: number;
  color?: string;
  size?: number;
  direction?: 'left' | 'right' | 'up' | 'down' | 'random';
  density?: number;
}

interface AnimationSettings {
  duration: number;
  fps: number;
  loop: boolean;
}

interface EffectsState {
  originalImage: string | null;
  effectResult: string | null;
  effectParams: EffectParameters;
  animationSettings: AnimationSettings;
  isProcessing: boolean;
  setOriginalImage: (image: string) => void;
  setEffectParams: (params: EffectParameters) => void;
  setAnimationSettings: (settings: AnimationSettings) => void;
  generateDynamicEffects: () => Promise<void>;
}

export const useEffectsStore = create<EffectsState>()(
  devtools((set, get) => ({
    originalImage: null,
    effectResult: null,
    effectParams: {
      effectType: 'particle_rain',
      intensity: 50,
      speed: 50,
      direction: 'down'
    },
    animationSettings: {
      duration: 3,
      fps: 24,
      loop: true
    },
    isProcessing: false,
    
    setOriginalImage: (image) => set({ originalImage: image }),
    
    setEffectParams: (params) => set({ effectParams: params }),
    
    setAnimationSettings: (settings) => set({ animationSettings: settings }),
    
    generateDynamicEffects: async () => {
      const { originalImage, effectParams, animationSettings } = get();
      if (!originalImage) return;
      
      set({ isProcessing: true });
      
      try {
        const result = await generateDynamicEffects({
          imageSrc: originalImage,
          ...effectParams,
          animationSettings
        });
        
        set({ 
          effectResult: result.videoSrc,
          isProcessing: false 
        });
      } catch (error) {
        set({ isProcessing: false });
        throw error;
      }
    }
  }))
);
```

## 5. UI/UX è®¾è®¡

### 5.1 ç•Œé¢å¸ƒå±€
```
+---------------------------------------------------------------+
| åŠ¨æ€ç‰¹æ•ˆç”Ÿæˆå·¥å…·                                              |
+-----------+----------------------+---------------------------+
| ç‰¹æ•ˆé¢æ¿  | é¢„è§ˆåŒºåŸŸ             | æ§åˆ¶é¢æ¿                  |
|           |                      |                           |
| [ç²’å­é›¨]  | [åŠ¨æ€é¢„è§ˆåŒºåŸŸ]       | [å¼ºåº¦: 50% ----o]         |
| [ç«ç„°]    |                      | [é€Ÿåº¦: 50% ----o]         |
| [å…‰æŸ]    |                      | [é¢œè‰²: #FF0000]           |
| [éœ“è™¹]    |                      | [å¤§å°: 50% ----o]         |
| [æ°´æ³¢çº¹]  |                      | [æ–¹å‘: â†“]                 |
+-----------+----------------------+---------------------------+
| åŠ¨ç”»æ—¶é—´è½´                                                |
| [0s]--------------------[1s]--------------------[3s]       |
| [â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– ]      |
+-----------------------------------------------------------+
| [ä¸Šä¼ å›¾ç‰‡] [ç”ŸæˆåŠ¨ç”»] [ä¸‹è½½ç»“æœ]                          |
+---------------------------------------------------------------+
```

### 5.2 äº¤äº’æµç¨‹
1. ç”¨æˆ·ä¸Šä¼ éœ€è¦æ·»åŠ ç‰¹æ•ˆçš„å›¾ç‰‡
2. ä»ç‰¹æ•ˆåº“ä¸­é€‰æ‹©å–œæ¬¢çš„åŠ¨æ€æ•ˆæœ
3. è°ƒæ•´ç‰¹æ•ˆå‚æ•°ï¼ˆå¼ºåº¦ã€é€Ÿåº¦ã€é¢œè‰²ç­‰ï¼‰
4. è®¾ç½®åŠ¨ç”»æ—¶é•¿å’Œå¾ªç¯é€‰é¡¹
5. å®æ—¶é¢„è§ˆåŠ¨æ€æ•ˆæœ
6. ç‚¹å‡»"ç”ŸæˆåŠ¨ç”»"æŒ‰é’®
7. æ˜¾ç¤ºå¤„ç†è¿›åº¦
8. å±•ç¤ºç”Ÿæˆçš„åŠ¨æ€å›¾ç‰‡
9. æä¾›ä¸‹è½½å’Œç»§ç»­ç¼–è¾‘é€‰é¡¹

## 6. å¼€å‘è®¡åˆ’

### 6.1 ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¡†æ¶æ­å»º (1å‘¨)
- [ ] åˆ›å»ºç»„ä»¶ç»“æ„å’Œæ–‡ä»¶
- [ ] å®ç° Zustand çŠ¶æ€ç®¡ç†
- [ ] è®¾è®¡ UI ç»„ä»¶
- [ ] å®ç°å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½

### 6.2 ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½å¼€å‘ (2å‘¨)
- [ ] å®ç°ç²’å­é›¨ç‰¹æ•ˆ
- [ ] å®ç°ç«ç„°ç²’å­ç‰¹æ•ˆ
- [ ] å®ç°å…‰æŸæ•ˆæœ
- [ ] å®ç°éœ“è™¹æ•ˆæœ

### 6.3 ç¬¬ä¸‰é˜¶æ®µï¼šæ‰©å±•åŠŸèƒ½å¼€å‘ (1å‘¨)
- [ ] å®ç°å…¶ä»–åŠ¨æ€ç‰¹æ•ˆ
- [ ] æ·»åŠ åŠ¨ç”»æ—¶é—´è½´åŠŸèƒ½
- [ ] å®ç°å¤šç§å¯¼å‡ºæ ¼å¼
- [ ] ä¼˜åŒ–å¤„ç†æ€§èƒ½

### 6.4 ç¬¬å››é˜¶æ®µï¼šæµ‹è¯•ä¸ä¼˜åŒ– (1å‘¨)
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] æ–‡æ¡£å®Œå–„

## 7. æµ‹è¯•æ–¹æ¡ˆ

### 7.1 å•å…ƒæµ‹è¯•
- æµ‹è¯•çŠ¶æ€ç®¡ç†åŠŸèƒ½
- æµ‹è¯•ç‰¹æ•ˆå‚æ•°éªŒè¯é€»è¾‘
- æµ‹è¯•åŠ¨ç”»è®¾ç½®é€»è¾‘

### 7.2 é›†æˆæµ‹è¯•
- æµ‹è¯•å®Œæ•´çš„åŠ¨æ€ç‰¹æ•ˆç”Ÿæˆæµç¨‹
- æµ‹è¯•ä¸åŒç‰¹æ•ˆçš„æ•ˆæœ
- æµ‹è¯•å¯¼å‡ºåŠŸèƒ½

### 7.3 ç”¨æˆ·éªŒæ”¶æµ‹è¯•
- é‚€è¯·å†…å®¹åˆ›ä½œè€…æµ‹è¯•æ•ˆæœ
- æ”¶é›†ç”¨æˆ·åé¦ˆ
- ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

## 8. éƒ¨ç½²ä¸ç»´æŠ¤

### 8.1 éƒ¨ç½²è¦æ±‚
- ç¡®ä¿302.AI APIå¯†é’¥é…ç½®æ­£ç¡®
- éªŒè¯å›¾åƒä¸Šä¼ å’Œå¤„ç†åŠŸèƒ½
- æµ‹è¯•ä¸åŒæµè§ˆå™¨å…¼å®¹æ€§

### 8.2 ç»´æŠ¤è®¡åˆ’
- å®šæœŸæ›´æ–°AIæ¨¡å‹
- æ·»åŠ æ–°çš„åŠ¨æ€ç‰¹æ•ˆ
- ç›‘æ§APIè°ƒç”¨æƒ…å†µ
- æ”¶é›†ç”¨æˆ·åé¦ˆå¹¶æŒç»­ä¼˜åŒ–