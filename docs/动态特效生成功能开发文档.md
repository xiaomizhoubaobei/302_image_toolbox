# 动态特效生成功能开发文档

## 1. 功能概述

### 1.1 功能名称
动态特效生成 (Dynamic Effects Generator)

### 1.2 功能描述
动态特效生成功能为静态图片添加各种动态视觉效果，包括粒子效果、光效、流动效果、霓虹效果等。通过AI技术和动画算法，让用户能够轻松创建具有视觉冲击力的动态图片。

### 1.3 目标用户
- 社交媒体内容创作者
- 视频制作人员
- 平面设计师
- 数字艺术家

## 2. 功能需求

### 2.1 核心功能
1. **多种动态效果**：提供至少15种不同的动态特效
2. **参数调节**：支持效果强度、速度、颜色等参数调节
3. **实时预览**：提供动态效果的实时预览
4. **自定义动画**：支持用户创建自定义动画路径
5. **导出格式**：支持GIF、MP4、WebM等格式导出

### 2.2 用户界面需求
1. 特效选择面板
2. 参数调节控制面板
3. 实时预览窗口
4. 动画时间轴
5. 导出设置面板

## 3. 技术实现方案

### 3.1 技术架构
```
前端组件层:
- DynamicEffects.tsx (主组件)
- EffectSelector.tsx (特效选择器)
- EffectPreview.tsx (预览组件)
- EffectControls.tsx (控制面板)
- AnimationTimeline.tsx (动画时间轴)

状态管理层:
- Zustand store (扩展现有状态)
- effectsSlice.ts (特效功能状态)

API层:
- lib/api.ts (新增特效API调用)
- utils/DynamicEffects.ts (特效处理工具)

类型定义层:
- types/index.ts (新增类型定义)
```

### 3.2 API接口设计
```typescript
// 动态特效API接口
interface DynamicEffectsAction {
  imageSrc: string;
  effectType: DynamicEffectType;
  parameters: EffectParameters;
  animationSettings: {
    duration: number; // 动画时长(秒)
    fps: number; // 帧率
    loop: boolean; // 是否循环
  };
  outputFormat: 'gif' | 'mp4' | 'webm';
}

interface EffectParameters {
  intensity: number; // 强度 0-100
  speed: number; // 速度 0-100
  color?: string; // 颜色
  size?: number; // 大小 0-100
  direction?: 'left' | 'right' | 'up' | 'down' | 'random'; // 方向
  density?: number; // 密度 0-100
}

type DynamicEffectType = 
  | 'particle_rain'      // 粒子雨
  | 'particle_fire'      // 火焰粒子
  | 'particle_snow'      // 雪花粒子
  | 'light_beam'         // 光束效果
  | 'lightning'          // 闪电效果
  | 'glow'               // 发光效果
  | 'neon'               // 霓虹效果
  | 'water_ripple'       // 水波纹
  | 'fireworks'          // 烟花效果
  | 'confetti'           // 彩纸效果
  | 'bubbles'            // 气泡效果
  | 'sparkles'           // 闪烁效果
  | 'swirl'              // 漩涡效果
  | 'wave'               // 波浪效果
  | 'pulse'              // 脉冲效果
  | 'custom_path';       // 自定义路径

interface DynamicEffectsResult {
  videoSrc: string;
  processingTime: number; // 处理时间(ms)
  frameCount: number; // 帧数
}

// 主要API函数
export async function generateDynamicEffects(action: DynamicEffectsAction): Promise<DynamicEffectsResult> {
  // 实现动态特效生成逻辑
}
```

### 3.3 组件设计

#### 3.3.1 主组件 DynamicEffects.tsx
```tsx
import React from 'react';
import { EffectSelector } from './EffectSelector';
import { EffectPreview } from './EffectPreview';
import { EffectControls } from './EffectControls';
import { AnimationTimeline } from './AnimationTimeline';
import { useEffectsStore } from '@/stores/effectsSlice';

export function DynamicEffects() {
  const { 
    originalImage, 
    effectResult, 
    effectParams,
    animationSettings,
    setEffectParams,
    setAnimationSettings,
    generateDynamicEffects,
    isProcessing
  } = useEffectsStore();

  return (
    <div className="dynamic-effects-container">
      <div className="effects-header">
        <h2>动态特效生成</h2>
        <p>为您的图片添加炫酷的动态视觉效果</p>
      </div>
      
      <div className="effects-content">
        <div className="effects-sidebar">
          <EffectSelector 
            selectedEffect={effectParams.effectType}
            onSelectEffect={(effect) => setEffectParams({ ...effectParams, effectType: effect })}
          />
          
          <EffectControls 
            params={effectParams}
            animationSettings={animationSettings}
            onChange={setEffectParams}
            onAnimationChange={setAnimationSettings}
            onGenerate={generateDynamicEffects}
            isProcessing={isProcessing}
          />
        </div>
        
        <div className="effects-main">
          <EffectPreview 
            image={originalImage}
            result={effectResult}
            isProcessing={isProcessing}
            isPlaying={true}
          />
        </div>
        
        <div className="effects-timeline">
          <AnimationTimeline 
            settings={animationSettings}
            onChange={setAnimationSettings}
          />
        </div>
      </div>
    </div>
  );
}
```

#### 3.3.2 特效选择器 EffectSelector.tsx
```tsx
import React from 'react';
import { DynamicEffectType } from '@/types';

interface EffectOption {
  id: DynamicEffectType;
  name: string;
  description: string;
  icon: string;
  previewImage: string;
}

const EFFECT_OPTIONS: EffectOption[] = [
  {
    id: 'particle_rain',
    name: '粒子雨',
    description: '飘落的彩色粒子效果',
    icon: '🌧️',
    previewImage: '/images/effects/particle_rain.gif'
  },
  {
    id: 'particle_fire',
    name: '火焰粒子',
    description: '燃烧的火焰粒子效果',
    icon: '🔥',
    previewImage: '/images/effects/particle_fire.gif'
  },
  {
    id: 'light_beam',
    name: '光束效果',
    description: '炫目的光线束效果',
    icon: '✨',
    previewImage: '/images/effects/light_beam.gif'
  },
  {
    id: 'neon',
    name: '霓虹效果',
    description: '闪烁的霓虹灯光效果',
    icon: '💡',
    previewImage: '/images/effects/neon.gif'
  },
  {
    id: 'water_ripple',
    name: '水波纹',
    description: '水面波纹扩散效果',
    icon: '💧',
    previewImage: '/images/effects/water_ripple.gif'
  }
  // 更多特效选项...
];

interface EffectSelectorProps {
  selectedEffect: DynamicEffectType;
  onSelectEffect: (effect: DynamicEffectType) => void;
}

export function EffectSelector({ selectedEffect, onSelectEffect }: EffectSelectorProps) {
  return (
    <div className="effect-selector">
      <h3>选择动态特效</h3>
      <div className="effect-grid">
        {EFFECT_OPTIONS.map((effect) => (
          <div 
            key={effect.id}
            className={`effect-option ${selectedEffect === effect.id ? 'selected' : ''}`}
            onClick={() => onSelectEffect(effect.id)}
          >
            <div className="effect-icon">{effect.icon}</div>
            <div className="effect-info">
              <h4>{effect.name}</h4>
              <p>{effect.description}</p>
            </div>
            <div className="effect-preview">
              <img src={effect.previewImage} alt={effect.name} />
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}
```

## 4. 状态管理设计

### 4.1 Zustand Store 扩展
```typescript
// stores/effectsSlice.ts
import { create } from 'zustand';
import { devtools } from 'zustand/middleware';
import { DynamicEffectType } from '@/types';

interface EffectParameters {
  effectType: DynamicEffectType;
  intensity: number;
  speed: number;
  color?: string;
  size?: number;
  direction?: 'left' | 'right' | 'up' | 'down' | 'random';
  density?: number;
}

interface AnimationSettings {
  duration: number;
  fps: number;
  loop: boolean;
}

interface EffectsState {
  originalImage: string | null;
  effectResult: string | null;
  effectParams: EffectParameters;
  animationSettings: AnimationSettings;
  isProcessing: boolean;
  setOriginalImage: (image: string) => void;
  setEffectParams: (params: EffectParameters) => void;
  setAnimationSettings: (settings: AnimationSettings) => void;
  generateDynamicEffects: () => Promise<void>;
}

export const useEffectsStore = create<EffectsState>()(
  devtools((set, get) => ({
    originalImage: null,
    effectResult: null,
    effectParams: {
      effectType: 'particle_rain',
      intensity: 50,
      speed: 50,
      direction: 'down'
    },
    animationSettings: {
      duration: 3,
      fps: 24,
      loop: true
    },
    isProcessing: false,
    
    setOriginalImage: (image) => set({ originalImage: image }),
    
    setEffectParams: (params) => set({ effectParams: params }),
    
    setAnimationSettings: (settings) => set({ animationSettings: settings }),
    
    generateDynamicEffects: async () => {
      const { originalImage, effectParams, animationSettings } = get();
      if (!originalImage) return;
      
      set({ isProcessing: true });
      
      try {
        const result = await generateDynamicEffects({
          imageSrc: originalImage,
          ...effectParams,
          animationSettings
        });
        
        set({ 
          effectResult: result.videoSrc,
          isProcessing: false 
        });
      } catch (error) {
        set({ isProcessing: false });
        throw error;
      }
    }
  }))
);
```

## 5. UI/UX 设计

### 5.1 界面布局
```
+---------------------------------------------------------------+
| 动态特效生成工具                                              |
+-----------+----------------------+---------------------------+
| 特效面板  | 预览区域             | 控制面板                  |
|           |                      |                           |
| [粒子雨]  | [动态预览区域]       | [强度: 50% ----o]         |
| [火焰]    |                      | [速度: 50% ----o]         |
| [光束]    |                      | [颜色: #FF0000]           |
| [霓虹]    |                      | [大小: 50% ----o]         |
| [水波纹]  |                      | [方向: ↓]                 |
+-----------+----------------------+---------------------------+
| 动画时间轴                                                |
| [0s]--------------------[1s]--------------------[3s]       |
| [■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■]      |
+-----------------------------------------------------------+
| [上传图片] [生成动画] [下载结果]                          |
+---------------------------------------------------------------+
```

### 5.2 交互流程
1. 用户上传需要添加特效的图片
2. 从特效库中选择喜欢的动态效果
3. 调整特效参数（强度、速度、颜色等）
4. 设置动画时长和循环选项
5. 实时预览动态效果
6. 点击"生成动画"按钮
7. 显示处理进度
8. 展示生成的动态图片
9. 提供下载和继续编辑选项

## 6. 开发计划

### 6.1 第一阶段：基础框架搭建 (1周)
- [ ] 创建组件结构和文件
- [ ] 实现 Zustand 状态管理
- [ ] 设计 UI 组件
- [ ] 实现图片上传功能

### 6.2 第二阶段：核心功能开发 (2周)
- [ ] 实现粒子雨特效
- [ ] 实现火焰粒子特效
- [ ] 实现光束效果
- [ ] 实现霓虹效果

### 6.3 第三阶段：扩展功能开发 (1周)
- [ ] 实现其他动态特效
- [ ] 添加动画时间轴功能
- [ ] 实现多种导出格式
- [ ] 优化处理性能

### 6.4 第四阶段：测试与优化 (1周)
- [ ] 功能测试
- [ ] 性能优化
- [ ] 用户体验优化
- [ ] 文档完善

## 7. 测试方案

### 7.1 单元测试
- 测试状态管理功能
- 测试特效参数验证逻辑
- 测试动画设置逻辑

### 7.2 集成测试
- 测试完整的动态特效生成流程
- 测试不同特效的效果
- 测试导出功能

### 7.3 用户验收测试
- 邀请内容创作者测试效果
- 收集用户反馈
- 优化用户体验

## 8. 部署与维护

### 8.1 部署要求
- 确保302.AI API密钥配置正确
- 验证图像上传和处理功能
- 测试不同浏览器兼容性

### 8.2 维护计划
- 定期更新AI模型
- 添加新的动态特效
- 监控API调用情况
- 收集用户反馈并持续优化